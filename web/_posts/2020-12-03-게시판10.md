# 게시판10) 파일 첨부

라이브러리

**pom.xml**

```xml
<!-- 파일 업/다운을 위한 dependency 추가 -->
<dependency>
	<groupId>commons-io</groupId>
	<artifactId>commons-io</artifactId>
	<version>2.5</version>
</dependency>
<dependency>
	<groupId>commons-fileupload</groupId>
	<artifactId>commons-fileupload</artifactId>
	<version>1.3.3</version>
</dependency>

```

**root-context.xml**

```xml
<!-- file upload를 위한 bean 설정 : 최대 10메가 -->
<bean name="multipartResolver"
     class="org.springframework.web.multipart.commons.CommonsMultipartResolver">
    <property name="maxUploadSize" value="10485760"></property>
</bean>
```

코드

**jsp**

```jsp
<form id ="" action ="boardwrite" method = "POST" enctype = "multipart/form-data">
    
    <td><input type= "file" name= "upload"></td>

</form>
```

**controller**

```java
@RequestMapping(value="/boardwrite" ,method=RequestMethod.POST)
public String boardWrite(
    Board board, 
    MultipartFile upload,
    HttpSession session) {

    //파일 업로드 하지 않은 경우 + 크기가 0byte인 파일이 업로드 됐을 경우
    //System.out.println("업로드 파일 : " + upload + ", 파일의 크기 체크" +upload.getSize() +"파일이 비었는지 : "+upload.isEmpty());		

    if(!upload.isEmpty()) {
        File path = new File(uploadPath);
        //이건 완전 최초만 .
        if(!path.isDirectory()) {
            path.mkdirs();
        }
        //파일의 진짜 이름
        String originalfile= upload.getOriginalFilename();
        //uuid
        String uid =UUID.randomUUID().toString();

        System.out.println(originalfile +","+uid);

        //파일의 저장이름
        String filename ;
        String ext;
        String savedfile;
        int lastIndex = originalfile.lastIndexOf('.');
        filename=originalfile.substring(0,lastIndex);

        //확장자가 없는 경우, 
        if(lastIndex==-1) {
            ext = "";			
        }else {
            //확장자가 있는 경우
            ext = "."+originalfile.substring(lastIndex+1);
        }

        savedfile = filename +"_"+ uid + ext;
        System.out.println(originalfile);
        System.out.println(savedfile);



        //파일 디스크에 저장하기
        File serverFile = new File(uploadPath +"/"+savedfile);
        //파일을 지정된 곳에 저장? 하게 해준다.
        try {
            upload.transferTo(serverFile);
        } catch (Exception e) {
            e.printStackTrace();
            originalfile = null;
            savedfile=null;
        }

        board.setOriginalfile(originalfile);
        board.setSavedfile(savedfile);
    }

    String userid = (String)session.getAttribute("loginId");
    board.setUserid(userid);
    System.out.println(board);
    repository.boardWrite(board);
    return "redirect:boardlist";
}
```

**mapper.xml**

```xml
<insert id="boardRegist" parameterType = "Board">
    INSERT INTO board
    (
    boardseq,
    userid,
    title,
    message
    <if test = "originalfile!=null and savedfile!=null">
        , originalfile
        ,savedfile
    </if>
    )
    VALUES
    (
    board_seq.nextval
    ,#{userid}
    ,#{title}
    ,#{message}
    <if test = "originalfile!=null and savedfile!=null">
        ,#{originalfile}
        ,#{savedfile}
    </if>
    )
```



```jsp
<if test = "originalfile!=null and savedfile!=null">
    ,#{originalfile}
    ,#{savedfile}
</if>
```

